# การปรับปรุงการแสดงผลตารางเวลา (TimeTable Merge Update)

## สรุปการเปลี่ยนแปลง

ปรับปรุงการแสดงผลตารางเวลาให้งานที่ต่อเนื่องกันแสดงเป็นสี่เหลี่ยมยาวแทนที่จะเป็นช่องแยกๆ และเพิ่มคอลัมน์เวลาพักเที่ยง 12:30-13:15

## การเปลี่ยนแปลงที่ทำ

### 1. ปรับปรุงฟังก์ชัน `generateTimeSlots`

**ไฟล์:** `frontend/Production_Planing.tsx`

**การเปลี่ยนแปลง:**
- เพิ่มการจัดการเวลาพักเที่ยง 12:30-13:15
- ข้ามเวลาพักเที่ยงในการสร้าง time slots
- เพิ่มคอลัมน์ "12:30-13:15" สำหรับเวลาพักเที่ยง

### 2. ปรับปรุงฟังก์ชัน `getTimeTableData`

**ไฟล์:** `frontend/Production_Planing.tsx`

**การเปลี่ยนแปลง:**
- เพิ่มการคำนวณ `colspan` สำหรับงานต่อเนื่อง
- เพิ่มการตรวจสอบ `isStart` และ `isEnd` เพื่อระบุจุดเริ่มต้นและจุดสิ้นสุดของงาน
- เพิ่มการตรวจสอบ `isLunchBreak` สำหรับเวลาพักเที่ยง
- ปรับปรุงการสร้างข้อมูล slot ให้รองรับการ merge และเวลาพักเที่ยง

**โค้ดที่เปลี่ยนแปลง:**
```typescript
// คำนวณ colspan สำหรับงานต่อเนื่อง
const jobStartSlotIndex = timeSlots.findIndex(s => s >= jobInfo.start_time);
const jobEndSlotIndex = timeSlots.findIndex(s => s >= jobInfo.end_time);
const colspan = jobEndSlotIndex > jobStartSlotIndex ? jobEndSlotIndex - jobStartSlotIndex : 1;

// ตรวจสอบว่าเป็น slot แรกของงานนี้หรือไม่
const isStart = slotIndex === jobStartSlotIndex;

// ตรวจสอบว่าเป็น slot สุดท้ายของงานนี้หรือไม่
const isEnd = slotIndex === jobStartSlotIndex + colspan - 1;
```

### 3. ปรับปรุงคอมโพเนนต์ `TimeTable`

**การเปลี่ยนแปลง:**
- เพิ่มการใช้ `colSpan` attribute สำหรับการ merge ช่อง
- เพิ่มการข้าม slot ที่ไม่ใช่จุดเริ่มต้นของงาน
- เพิ่มการแสดงผลเวลาพักเที่ยงด้วยสีที่แตกต่าง
- ปรับปรุงการแสดงผลให้รองรับการ merge และเวลาพักเที่ยง
- ปรับปรุงขนาดและความชัดเจนของหัวคอลัมน์เวลา
- เพิ่ม shadow และปรับขนาดตารางให้ใหญ่ขึ้น

**โค้ดที่เปลี่ยนแปลง:**
```typescript
{row.slots.map((slot, i) => {
  // ข้าม slot ที่ไม่ใช่จุดเริ่มต้นของงาน
  if (slot.hasJob && !slot.isStart) {
    return null;
  }
  
  return (
    <td 
      key={i} 
      colSpan={slot.hasJob ? slot.colspan : 1}
      className={`border p-2 relative ${
        slot.hasJob 
          ? workerColors[row.name as keyof typeof workerColors] || "bg-green-400" 
          : "bg-white"
      }`}
    >
      {slot.hasJob && (
        <div className="flex items-center justify-center text-white text-sm font-medium min-h-[40px] overflow-hidden">
          <span className="text-center leading-tight" title={slot.jobName}>
            {slot.jobName}
          </span>
        </div>
      )}
    </td>
  );
})}
```

## ผลลัพธ์

### ก่อนการแก้ไข:
- งานที่ทำตั้งแต่ 9:30-12:30 แสดงเป็นช่องแยก 6 ช่อง (9:30, 10:00, 10:30, 11:00, 11:30, 12:00)
- แต่ละช่องแสดงงานแยกกัน
- ไม่มีคอลัมน์แยกสำหรับเวลาพักเที่ยง

### หลังการแก้ไข:
- งานที่ทำตั้งแต่ 9:30-12:30 แสดงเป็นสี่เหลี่ยมยาว 1 ช่อง
- ใช้ `colSpan` เพื่อ merge ช่องที่ต่อเนื่องกัน
- เพิ่มคอลัมน์ "พักเที่ยง" สำหรับเวลา 12:30-13:15
- การแสดงผลดูเป็นระเบียบและเข้าใจง่ายขึ้น

## ตัวอย่างการใช้งาน

งานที่ทำตั้งแต่ 9:30-12:30 จะแสดงเป็น:
```
┌─────────────────────────────────────────────────────────┐
│                    หมูสะเต๊ะ                           │
└─────────────────────────────────────────────────────────┘
```

แทนที่จะเป็น:
```
┌─────────┐─────────┐─────────┐─────────┐─────────┐─────────┐
│หมูสะเต๊ะ│หมูสะเต๊ะ│หมูสะเต๊ะ│หมูสะเต๊ะ│หมูสะเต๊ะ│หมูสะเต๊ะ│
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
```

## การทดสอบ

1. เปิดแอปพลิเคชัน
2. ไปที่หน้า TimeTable
3. ตรวจสอบว่างานที่ต่อเนื่องกันแสดงเป็นสี่เหลี่ยมยาว
4. ตรวจสอบว่างานที่แยกกันยังคงแสดงแยกช่อง

## หมายเหตุ

- การเปลี่ยนแปลงนี้ใช้เฉพาะกับ TimeTable component
- ไม่กระทบกับการแสดงผลในส่วนอื่นของแอปพลิเคชัน
- รองรับการแสดงผลงานที่มีระยะเวลาต่อเนื่องตั้งแต่ 30 นาทีขึ้นไป 