# р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓ Query р╕Чр╕╡р╣Ир╕Чр╕│р╣Гр╕лр╣Йр╣Др╕Фр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Др╕гр╕Ъ

## р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ
- р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е `esp_tracker_empty` р╕бр╕╡ 134 р╕Зр╕▓р╕Щ
- р╣Бр╕Хр╣Ир╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ър╣Бр╕кр╕Фр╕Зр╣Бр╕Др╣И 50 р╕Зр╕▓р╕Щ
- р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Бр╕┤р╕Фр╕Ир╕▓р╕Бр╕Бр╕▓р╕г query р╕Чр╕╡р╣Ир╣Гр╕Кр╣Й `ORDER BY` р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╕Чр╕│р╣Гр╕лр╣Йр╣Др╕Фр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Др╕гр╕Ъ

## р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕Вр╕нр╕Зр╕Ыр╕▒р╕Нр╕лр╕▓

### 1. р╕Бр╕▓р╕гр╣Гр╕Кр╣Й ORDER BY р╣Гр╕Щ Query р╕лр╕ер╕▒р╕Б
Query р╣Ар╕Фр╕┤р╕бр╣Гр╕Кр╣Й:
```sql
ORDER BY wp.production_date DESC, wp.start_time ASC
```

р╕Лр╕╢р╣Ир╕Зр╕нр╕▓р╕Ир╕Чр╕│р╣Гр╕лр╣Й:
- р╣Др╕Фр╣Йр╣Ар╕Йр╕Юр╕▓р╕░р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╣Ир╕▓р╕кр╕╕р╕Ф
- р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕гр╕╖р╣Ир╕нр╕З timezone conversion
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕бр╕╡ `production_date` р╣Ар╕Ыр╣Зр╕Щ NULL р╕Ир╕░р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 2. р╕Бр╕▓р╕гр╣Гр╕Кр╣Й LIMIT р╕Бр╕▒р╕Ъ ORDER BY
р╕Бр╕▓р╕гр╣Гр╕Кр╣Й `ORDER BY` р╕гр╣Ир╕зр╕бр╕Бр╕▒р╕Ъ `LIMIT` р╕нр╕▓р╕Ир╕Чр╕│р╣Гр╕лр╣Йр╣Др╕Фр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ

## р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣Ир╕Чр╕│

### 1. р╕ер╕Ъ ORDER BY р╕нр╕нр╕Бр╕Ир╕▓р╕Б Query р╕лр╕ер╕▒р╕Б
р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕Щр╣Др╕Яр╕ер╣М `backend/routes/reportRoutes.js`:

```javascript
// р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В
const analysisQuery = `
  SELECT 
    wp.id as work_plan_id,
    wp.job_code,
    wp.job_name,
    ...
  FROM work_plans wp
  LEFT JOIN production_rooms pr ON wp.production_room_id = pr.id
  ORDER BY wp.production_date DESC, wp.start_time ASC
  LIMIT ${safeLimit}
`;

// р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В
const analysisQuery = `
  SELECT 
    wp.id as work_plan_id,
    wp.job_code,
    wp.job_name,
    ...
  FROM work_plans wp
  LEFT JOIN production_rooms pr ON wp.production_room_id = pr.id
  LIMIT ${safeLimit}
`;
```

### 2. р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕г Log р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ
р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕г log р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Др╕Фр╣Й:

```javascript
console.log('ЁЯУК Total work plans processed:', jobsWithLogs.length);
console.log('ЁЯУК Unique job codes found:', new Set(jobsWithLogs.map(job => job.job_code)).size);
```

## р╣Др╕Яр╕ер╣М SQL р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### 1. `debug_query_issue.sql`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕г query
- р╕Чр╕Фр╕кр╕нр╕Ъ query р╕Чр╕╡р╣Ир╕гр╕░р╕Ър╕Ър╣Гр╕Кр╣Йр╕Ир╕гр╕┤р╕З
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е production_date

### 2. `check_job_statistics_calculation.sql`
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У job statistics
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ job_code р╕Чр╕╡р╣Ир╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ records р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕бр╕╡ production_date

## р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З

р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з:
- р╕гр╕░р╕Ър╕Ър╕Др╕зр╕гр╣Бр╕кр╕Фр╕Зр╕Зр╕▓р╕Щр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф 134 р╕Зр╕▓р╕Щ
- р╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕гр╕╖р╣Ир╕нр╕З ORDER BY
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ

## р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. р╕гр╕▒р╕Щ SQL Queries
р╕гр╕▒р╕Щ queries р╣Гр╕Щр╣Др╕Яр╕ер╣М `debug_query_issue.sql` р╣Бр╕ер╕░ `check_job_statistics_calculation.sql` р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е

### 2. р╕Чр╕Фр╕кр╕нр╕Ър╕лр╕Щр╣Йр╕▓ Reports
- р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓ Reports
- р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕З

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Logs
р╕Фр╕╣ logs р╕Вр╕нр╕З backend р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
```
ЁЯУК Total work plans processed: [р╕Ир╕│р╕Щр╕зр╕Щ]
ЁЯУК Unique job codes found: [р╕Ир╕│р╕Щр╕зр╕Щ]
ЁЯУК Job statistics calculated: [р╕Ир╕│р╕Щр╕зр╕Щ] unique job types
```

## р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

- р╕Бр╕▓р╕гр╕ер╕Ъ ORDER BY р╕нр╕▓р╕Ир╕Чр╕│р╣Гр╕лр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╕Хр╕▓р╕бр╕зр╕▒р╕Щр╕Чр╕╡р╣И
- р╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╕Ир╕░р╕Чр╕│р╣Гр╕Щ frontend р╣Бр╕Чр╕Щ
- р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╕нр╕▓р╕Ир╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У job_statistics р╣Гр╕Щр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `calculateJobStatistics` 